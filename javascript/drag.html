<!DOCTYPE html><html lang="zh-CN" prefix="og: http://ogp.me/ns#"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>JavaScript拖拉事件 - JavaScript教程 - V站前端教程</title><!-- link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" --><link rel="stylesheet" href="../assets/css/app.min.css"><link rel="stylesheet" href="https://apps.bdimg.com/libs/fontawesome/4.4.0/css/font-awesome.css"><!-- link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.css"--><!-- link rel="stylesheet" href="../assets/css/share.min.css" --><meta property="og:type" content="article"><meta property="og:title" content="JavaScript拖拉事件"><link rel="apple-touch-icon" href="../assets/icons/logo.png"><link rel="icon" type="image/png" href="../assets/icons/logo.png"><style>.nav-item-active{background-color: #fff;color:#9cba39}
      a{color:#399ab2}
      a:hover{color:#9cba39}
      .breadcrumb a{color:#399ab2}
      .breadcrumb a:hover{color:#9cba39}
      .navbar.is-light .navbar-end .navbar-link, .navbar.is-light .navbar-end>.navbar-item, 
      .navbar.is-light .navbar-start>.navbar-item:hover{color:#9cba39}
      .navbar-link, a.navbar-item:hover{color:#9cba39}
      .footer{padding:1.5rem 0;}

      .panel-info .panel-block .menu-list a.is-active, .panel-menu .panel-block .menu-list a.is-active {
        color: #fff;
        background-color: #399ab2;
      }
      .menu-list>li{background:#F9F9F9;border-bottom: 1px solid #ededed;} 
      .menu-list .menu-item-title{height: 35px;line-height: 35px;text-align: center;background-color: #EDEDED;color:#9cba39;font-weight: bold;}
      .menu-list > li > a .menu-list-title::before {
          font-weight: 700;
          content: "";
      }

      .panel-info .panel-block .menu, .panel-menu .panel-block .menu{padding:0 5px}</style></head><body><nav class="navbar is-light" role="navigation" id="navbar" aria-label="main navigation"><div class="container" style="max-width:1230px;"><div class="navbar-brand"><a href="/" class="navbar-item title has-text-grey has-text-weight-light is-5">V站 / ViJian.com</a></div><div class="navbar-menu" id="navMenu"><div class="navbar-start"><div class="navbar-item"><a class="navbar-item" href="/">首页</a></div><div class="navbar-item has-dropdown is-hoverable"><a class="navbar-link nav-item-active is-hidden-touch">教程</a><div class="navbar-dropdown"><a class="navbar-item" href="/html/intro.html">HTML 教程</a> <a class="navbar-item" href="/javascript/intro.html">JavaScript 教程</a> <a class="navbar-item" href="/es6/intro.html">ES6 教程</a> <a class="navbar-item" href="/typescript/intro.html">TypeScript 教程</a><!--   <a class="navbar-item" href="/webapi/intro.html">Web API 教程</a>
             <a class="navbar-item" href="/css/intro.html">CSS 教程</a>
       --></div></div></div><div class="navbar-end"></div></div></div></nav><section class="section main article" style="padding-top: 20px;"><div class="container" style="max-width:1260px;"><div class="columns"><div class="column" style="flex:none;width:16%"><nav class="panel-menu" style="border: 1px solid #ededed;"><p class="panel-heading" style="font-size: 1.0em;border-radius:0px;padding: 0.5em 0em;text-align: center;"><i class="fa fa-book" aria-hidden="true"></i> JavaScript教程</p><div class="panel-block" style="padding: 5px 0px;"><aside class="menu"><ul class="menu-list"><li class="menu-item-title" data="basic_item">基本</li><li class="basic_item"><a href="../javascript/intro.html">&nbsp; <span class="menu-list-title" style="width:100%">1.导论</span></a></li><li class="basic_item"><a href="../javascript/grammar.html">&nbsp; <span class="menu-list-title" style="width:100%">2.基本语法</span></a></li><li class="basic_item"><a href="../javascript/history.html">&nbsp; <span class="menu-list-title" style="width:100%">3.语言的历史</span></a></li><li class="menu-item-title" data="types_item">数据类型</li><li class="types_item"><a href="../javascript/typegeneral.html">&nbsp; <span class="menu-list-title" style="width:100%">1.数据类型概述</span></a></li><li class="types_item"><a href="../javascript/null-undefined-boolean.html">&nbsp; <span class="menu-list-title" style="width:100%">2.null, undefined 和布尔值</span></a></li><li class="types_item"><a href="../javascript/typenumber.html">&nbsp; <span class="menu-list-title" style="width:100%">3.数值</span></a></li><li class="types_item"><a href="../javascript/typestring.html">&nbsp; <span class="menu-list-title" style="width:100%">4.字符串</span></a></li><li class="types_item"><a href="../javascript/typeobject.html">&nbsp; <span class="menu-list-title" style="width:100%">5.对象</span></a></li><li class="types_item"><a href="../javascript/function.html">&nbsp; <span class="menu-list-title" style="width:100%">6.函数</span></a></li><li class="types_item"><a href="../javascript/typearray.html">&nbsp; <span class="menu-list-title" style="width:100%">7.数组</span></a></li><li class="menu-item-title" data="operator_item">运算符</li><li class="operator_item"><a href="../javascript/arithmetic.html">&nbsp; <span class="menu-list-title" style="width:100%">1.算术运算符</span></a></li><li class="operator_item"><a href="../javascript/comparison.html">&nbsp; <span class="menu-list-title" style="width:100%">2.比较运算符</span></a></li><li class="operator_item"><a href="../javascript/boolean.html">&nbsp; <span class="menu-list-title" style="width:100%">3.布尔运算符</span></a></li><li class="operator_item"><a href="../javascript/bit.html">&nbsp; <span class="menu-list-title" style="width:100%">4.二进制位运算符</span></a></li><li class="operator_item"><a href="../javascript/priority.html">&nbsp; <span class="menu-list-title" style="width:100%">5.其他运算符，运算顺序</span></a></li><li class="menu-item-title" data="feature_item">语法</li><li class="feature_item"><a href="../javascript/conversion.html">&nbsp; <span class="menu-list-title" style="width:100%">1.数据类型的转换</span></a></li><li class="feature_item"><a href="../javascript/error.html">&nbsp; <span class="menu-list-title" style="width:100%">2.错误处理机制</span></a></li><li class="feature_item"><a href="../javascript/style.html">&nbsp; <span class="menu-list-title" style="width:100%">3.编程风格</span></a></li><li class="feature_item"><a href="../javascript/console.html">&nbsp; <span class="menu-list-title" style="width:100%">4.console 对象与控制台</span></a></li><li class="menu-item-title" data="lib_item">标准库</li><li class="lib_item"><a href="../javascript/libobject.html">&nbsp; <span class="menu-list-title" style="width:100%">1.Object 对象</span></a></li><li class="lib_item"><a href="../javascript/libattributes.html">&nbsp; <span class="menu-list-title" style="width:100%">2.属性描述对象</span></a></li><li class="lib_item"><a href="../javascript/array.html">&nbsp; <span class="menu-list-title" style="width:100%">3.Array 对象</span></a></li><li class="lib_item"><a href="../javascript/wrapper.html">&nbsp; <span class="menu-list-title" style="width:100%">4.包装对象</span></a></li><li class="lib_item"><a href="../javascript/libboolean.html">&nbsp; <span class="menu-list-title" style="width:100%">5.Boolean 对象</span></a></li><li class="lib_item"><a href="../javascript/number.html">&nbsp; <span class="menu-list-title" style="width:100%">6.Number 对象</span></a></li><li class="lib_item"><a href="../javascript/string.html">&nbsp; <span class="menu-list-title" style="width:100%">7.String 对象</span></a></li><li class="lib_item"><a href="../javascript/math.html">&nbsp; <span class="menu-list-title" style="width:100%">8.Math 对象</span></a></li><li class="lib_item"><a href="../javascript/date.html">&nbsp; <span class="menu-list-title" style="width:100%">9.Date 对象</span></a></li><li class="lib_item"><a href="../javascript/regexp.html">&nbsp; <span class="menu-list-title" style="width:100%">10.RegExp 对象</span></a></li><li class="lib_item"><a href="../javascript/json.html">&nbsp; <span class="menu-list-title" style="width:100%">11.JSON 对象</span></a></li><li class="menu-item-title" data="oop_item">面向对象</li><li class="oop_item"><a href="../javascript/new.html">&nbsp; <span class="menu-list-title" style="width:100%">1.实例对象与 new 命令</span></a></li><li class="oop_item"><a href="../javascript/this.html">&nbsp; <span class="menu-list-title" style="width:100%">2.this 关键字</span></a></li><li class="oop_item"><a href="../javascript/prototype.html">&nbsp; <span class="menu-list-title" style="width:100%">3.对象的继承</span></a></li><li class="oop_item"><a href="../javascript/object.html">&nbsp; <span class="menu-list-title" style="width:100%">4.Object 对象的相关方法</span></a></li><li class="oop_item"><a href="../javascript/strict.html">&nbsp; <span class="menu-list-title" style="width:100%">5.严格模式</span></a></li><li class="menu-item-title" data="async_item">异步</li><li class="async_item"><a href="../javascript/general.html">&nbsp; <span class="menu-list-title" style="width:100%">1.异步操作概述</span></a></li><li class="async_item"><a href="../javascript/timer.html">&nbsp; <span class="menu-list-title" style="width:100%">2.定时器</span></a></li><li class="async_item"><a href="../javascript/promise.html">&nbsp; <span class="menu-list-title" style="width:100%">3.Promise 对象</span></a></li><li class="menu-item-title" data="dom_item">DOM</li><li class="dom_item"><a href="../javascript/domgeneral.html">&nbsp; <span class="menu-list-title" style="width:100%">1.DOM 概述</span></a></li><li class="dom_item"><a href="../javascript/node.html">&nbsp; <span class="menu-list-title" style="width:100%">2.Node 接口</span></a></li><li class="dom_item"><a href="../javascript/nodelist.html">&nbsp; <span class="menu-list-title" style="width:100%">3.NodeList 接口，HTMLCollection 接口</span></a></li><li class="dom_item"><a href="../javascript/parentnode.html">&nbsp; <span class="menu-list-title" style="width:100%">4.ParentNode 接口，ChildNode 接口</span></a></li><li class="dom_item"><a href="../javascript/document.html">&nbsp; <span class="menu-list-title" style="width:100%">5.Document 节点</span></a></li><li class="dom_item"><a href="../javascript/element.html">&nbsp; <span class="menu-list-title" style="width:100%">6.Element 节点</span></a></li><li class="dom_item"><a href="../javascript/attributes.html">&nbsp; <span class="menu-list-title" style="width:100%">7.属性的操作</span></a></li><li class="dom_item"><a href="../javascript/text.html">&nbsp; <span class="menu-list-title" style="width:100%">8.Text 节点和 DocumentFragment 节点</span></a></li><li class="dom_item"><a href="../javascript/css.html">&nbsp; <span class="menu-list-title" style="width:100%">9.CSS 操作</span></a></li><li class="dom_item"><a href="../javascript/mutationobserver.html">&nbsp; <span class="menu-list-title" style="width:100%">10.Mutation Observer API</span></a></li><li class="menu-item-title" data="event_item">事件</li><li class="event_item"><a href="../javascript/eventtarget.html">&nbsp; <span class="menu-list-title" style="width:100%">1.EventTarget 接口</span></a></li><li class="event_item"><a href="../javascript/model.html">&nbsp; <span class="menu-list-title" style="width:100%">2.事件模型</span></a></li><li class="event_item"><a href="../javascript/event.html">&nbsp; <span class="menu-list-title" style="width:100%">3.Event 对象</span></a></li><li class="event_item"><a href="../javascript/mouse.html">&nbsp; <span class="menu-list-title" style="width:100%">4.鼠标事件</span></a></li><li class="event_item"><a href="../javascript/keyboard.html">&nbsp; <span class="menu-list-title" style="width:100%">5.键盘事件</span></a></li><li class="event_item"><a href="../javascript/progress.html">&nbsp; <span class="menu-list-title" style="width:100%">6.进度事件</span></a></li><li class="event_item"><a href="../javascript/eventform.html">&nbsp; <span class="menu-list-title" style="width:100%">7.表单事件</span></a></li><li class="event_item"><a href="../javascript/touch.html">&nbsp; <span class="menu-list-title" style="width:100%">8.触摸事件</span></a></li><li class="event_item"><a href="../javascript/drag.html" class="is-active">&nbsp; <span class="menu-list-title" style="width:100%">9.拖拉事件</span></a></li><li class="event_item"><a href="../javascript/common.html">&nbsp; <span class="menu-list-title" style="width:100%">10.其他常见事件</span></a></li><li class="event_item"><a href="../javascript/globaleventhandlers.html">&nbsp; <span class="menu-list-title" style="width:100%">11.GlobalEventHandlers 接口</span></a></li><li class="menu-item-title" data="bom_item">BOM</li><li class="bom_item"><a href="../javascript/engine.html">&nbsp; <span class="menu-list-title" style="width:100%">1.浏览器环境概述</span></a></li><li class="bom_item"><a href="../javascript/window.html">&nbsp; <span class="menu-list-title" style="width:100%">2.window 对象</span></a></li><li class="bom_item"><a href="../javascript/navigator.html">&nbsp; <span class="menu-list-title" style="width:100%">3.Navigator 对象，Screen 对象</span></a></li><li class="bom_item"><a href="../javascript/cookie.html">&nbsp; <span class="menu-list-title" style="width:100%">4.Cookie</span></a></li><li class="bom_item"><a href="../javascript/xmlhttprequest.html">&nbsp; <span class="menu-list-title" style="width:100%">5.XMLHttpRequest 对象</span></a></li><li class="bom_item"><a href="../javascript/same-origin.html">&nbsp; <span class="menu-list-title" style="width:100%">6.同源限制</span></a></li><li class="bom_item"><a href="../javascript/cors.html">&nbsp; <span class="menu-list-title" style="width:100%">7.CORS 通信</span></a></li><li class="bom_item"><a href="../javascript/storage.html">&nbsp; <span class="menu-list-title" style="width:100%">8.Storage 接口</span></a></li><li class="bom_item"><a href="../javascript/bomhistory.html">&nbsp; <span class="menu-list-title" style="width:100%">9.History 对象</span></a></li><li class="bom_item"><a href="../javascript/location.html">&nbsp; <span class="menu-list-title" style="width:100%">10.Location 对象，URL 对象，URLSearchParams 对象</span></a></li><li class="bom_item"><a href="../javascript/arraybuffer.html">&nbsp; <span class="menu-list-title" style="width:100%">11.ArrayBuffer 对象，Blob 对象</span></a></li><li class="bom_item"><a href="../javascript/file.html">&nbsp; <span class="menu-list-title" style="width:100%">12.File 对象，FileList 对象，FileReader 对象</span></a></li><li class="bom_item"><a href="../javascript/form.html">&nbsp; <span class="menu-list-title" style="width:100%">13.表单，FormData 对象</span></a></li><li class="bom_item"><a href="../javascript/indexeddb.html">&nbsp; <span class="menu-list-title" style="width:100%">14.IndexedDB API</span></a></li><li class="bom_item"><a href="../javascript/webworker.html">&nbsp; <span class="menu-list-title" style="width:100%">15.Web Worker</span></a></li><li class="menu-item-title" data="element_item">元素</li><li class="element_item"><a href="../javascript/a.html">&nbsp; <span class="menu-list-title" style="width:100%">1.a</span></a></li><li class="element_item"><a href="../javascript/image.html">&nbsp; <span class="menu-list-title" style="width:100%">2.image</span></a></li><li class="element_item"><a href="../javascript/elementform.html">&nbsp; <span class="menu-list-title" style="width:100%">3.form</span></a></li><li class="element_item"><a href="../javascript/input.html">&nbsp; <span class="menu-list-title" style="width:100%">4.input</span></a></li><li class="element_item"><a href="../javascript/button.html">&nbsp; <span class="menu-list-title" style="width:100%">5.button</span></a></li><li class="element_item"><a href="../javascript/option.html">&nbsp; <span class="menu-list-title" style="width:100%">6.option</span></a></li><li class="element_item"><a href="../javascript/video.html">&nbsp; <span class="menu-list-title" style="width:100%">7.video，audio</span></a></li></ul></aside></div></nav></div><div class="column" style="flex:none;width:68%"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="../"><span class="icon"><i class="fa fa-home"></i></span> &nbsp;V站</a></li><li><a href="../javascript/intro.html">JavaScript教程</a></li><li><a href="../javascript/drag.html">JavaScript 拖拉事件</a></li></ul></nav><nav class="level level-previous-next is-mobile"><!-- Left side --><div class="level-left"><p class="level-item is-narrow"><a href="../javascript/touch.html"><span class="icon"><i class="fa fa-toggle-left"></i></span> 触摸事件</a></p></div><div class="level-right"><p class="level-item is-narrow"><a href="../javascript/common.html">其他常见事件 <span class="icon"><i class="fa fa-toggle-right"></i></span></a></p></div></nav><article class="content"><h1 class="title">JavaScript 拖拉事件</h1><div class="page-meta"><p>V站（ViJian.com）</p></div><h2 id="拖拉事件的种类">拖拉事件的种类 <a class="markdownIt-Anchor" href="#拖拉事件的种类">#</a></h2><p>拖拉（drag）指的是，用户在某个对象上按下鼠标键不放，拖动它到另一个位置，然后释放鼠标键，将该对象放在那里。</p><p>拖拉的对象有好几种，包括元素节点、图片、链接、选中的文字等等。在网页中，除了元素节点默认不可以拖拉，其他（图片、链接、选中的文字）都可以直接拖拉。为了让元素节点可拖拉，可以将该节点的<code>draggable</code>属性设为<code>true</code>。</p><pre class="hljs"><code><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">draggable</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span>
  此区域可拖拉
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre><p>上面代码的<code>div</code>区块，在网页中可以直接用鼠标拖动。松开鼠标键时，拖动效果就会消失，该区块依然在原来的位置。</p><p><code>draggable</code>属性可用于任何元素节点，但是图片（<code>&lt;img&gt;</code>）和链接（<code>&lt;a&gt;</code>）不加这个属性，就可以拖拉。对于它们，用到这个属性的时候，往往是将其设为<code>false</code>，防止拖拉这两种元素。</p><p>注意，一旦某个元素节点的<code>draggable</code>属性设为<code>true</code>，就无法再用鼠标选中该节点内部的文字或子节点了。</p><p>当元素节点或选中的文本被拖拉时，就会持续触发拖拉事件，包括以下一些事件。</p><ul><li><code>drag</code>：拖拉过程中，在被拖拉的节点上持续触发（相隔几百毫秒）。</li><li><code>dragstart</code>：用户开始拖拉时，在被拖拉的节点上触发，该事件的<code>target</code>属性是被拖拉的节点。通常应该在这个事件的监听函数中，指定拖拉的数据。</li><li><code>dragend</code>：拖拉结束时（释放鼠标键或按下 ESC 键）在被拖拉的节点上触发，该事件的<code>target</code>属性是被拖拉的节点。它与<code>dragstart</code>事件，在同一个节点上触发。不管拖拉是否跨窗口，或者中途被取消，<code>dragend</code>事件总是会触发的。</li><li><code>dragenter</code>：拖拉进入当前节点时，在当前节点上触发一次，该事件的<code>target</code>属性是当前节点。通常应该在这个事件的监听函数中，指定是否允许在当前节点放下（drop）拖拉的数据。如果当前节点没有该事件的监听函数，或者监听函数不执行任何操作，就意味着不允许在当前节点放下数据。在视觉上显示拖拉进入当前节点，也是在这个事件的监听函数中设置。</li><li><code>dragover</code>：拖拉到当前节点上方时，在当前节点上持续触发（相隔几百毫秒），该事件的<code>target</code>属性是当前节点。该事件与<code>dragenter</code>事件的区别是，<code>dragenter</code>事件在进入该节点时触发，然后只要没有离开这个节点，<code>dragover</code>事件会持续触发。</li><li><code>dragleave</code>：拖拉操作离开当前节点范围时，在当前节点上触发，该事件的<code>target</code>属性是当前节点。如果要在视觉上显示拖拉离开操作当前节点，就在这个事件的监听函数中设置。</li><li><code>drop</code>：被拖拉的节点或选中的文本，释放到目标节点时，在目标节点上触发。注意，如果当前节点不允许<code>drop</code>，即使在该节点上方松开鼠标键，也不会触发该事件。如果用户按下 ESC 键，取消这个操作，也不会触发该事件。该事件的监听函数负责取出拖拉数据，并进行相关处理。</li></ul><p>下面的例子展示，如何动态改变被拖动节点的背景色。</p><pre class="hljs"><code>div.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;dragstart&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">style</span>.<span class="hljs-property">backgroundColor</span> = <span class="hljs-string">&#x27;red&#x27;</span>;
}, <span class="hljs-literal">false</span>);

div.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;dragend&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">style</span>.<span class="hljs-property">backgroundColor</span> = <span class="hljs-string">&#x27;green&#x27;</span>;
}, <span class="hljs-literal">false</span>);
</code></pre><p>上面代码中，<code>div</code>节点被拖动时，背景色会变为红色，拖动结束，又变回绿色。</p><p>下面是一个例子，展示如何实现将一个节点从当前父节点，拖拉到另一个父节点中。</p><pre class="hljs"><code><span class="hljs-comment">/* HTML 代码如下
 &lt;div class=&quot;dropzone&quot;&gt;
   &lt;div id=&quot;draggable&quot; draggable=&quot;true&quot;&gt;
     该节点可拖拉
   &lt;/div&gt;
 &lt;/div&gt;
 &lt;div class=&quot;dropzone&quot;&gt;&lt;/div&gt;
 &lt;div class=&quot;dropzone&quot;&gt;&lt;/div&gt;
 &lt;div class=&quot;dropzone&quot;&gt;&lt;/div&gt;
*/</span>

<span class="hljs-comment">// 被拖拉节点</span>
<span class="hljs-keyword">var</span> dragged;

<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;dragstart&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) {
  <span class="hljs-comment">// 保存被拖拉节点</span>
  dragged = event.<span class="hljs-property">target</span>;
  <span class="hljs-comment">// 被拖拉节点的背景色变透明</span>
  event.<span class="hljs-property">target</span>.<span class="hljs-property">style</span>.<span class="hljs-property">opacity</span> = <span class="hljs-number">0.5</span>;
}, <span class="hljs-literal">false</span>);

<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;dragend&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) {
  <span class="hljs-comment">// 被拖拉节点的背景色恢复正常</span>
  event.<span class="hljs-property">target</span>.<span class="hljs-property">style</span>.<span class="hljs-property">opacity</span> = <span class="hljs-string">&#x27;&#x27;</span>;
}, <span class="hljs-literal">false</span>);

<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;dragover&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) {
  <span class="hljs-comment">// 防止拖拉效果被重置，允许被拖拉的节点放入目标节点</span>
  event.<span class="hljs-title function_">preventDefault</span>();
}, <span class="hljs-literal">false</span>);

<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;dragenter&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) {
  <span class="hljs-comment">// 目标节点的背景色变紫色</span>
  <span class="hljs-comment">// 由于该事件会冒泡，所以要过滤节点</span>
  <span class="hljs-keyword">if</span> (event.<span class="hljs-property">target</span>.<span class="hljs-property">className</span> === <span class="hljs-string">&#x27;dropzone&#x27;</span>) {
    event.<span class="hljs-property">target</span>.<span class="hljs-property">style</span>.<span class="hljs-property">background</span> = <span class="hljs-string">&#x27;purple&#x27;</span>;
  }
}, <span class="hljs-literal">false</span>);

<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;dragleave&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"> event </span>) {
  <span class="hljs-comment">// 目标节点的背景色恢复原样</span>
  <span class="hljs-keyword">if</span> (event.<span class="hljs-property">target</span>.<span class="hljs-property">className</span> === <span class="hljs-string">&#x27;dropzone&#x27;</span>) {
    event.<span class="hljs-property">target</span>.<span class="hljs-property">style</span>.<span class="hljs-property">background</span> = <span class="hljs-string">&#x27;&#x27;</span>;
  }
}, <span class="hljs-literal">false</span>);

<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;drop&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"> event </span>) {
  <span class="hljs-comment">// 防止事件默认行为（比如某些元素节点上可以打开链接），</span>
  event.<span class="hljs-title function_">preventDefault</span>();
  <span class="hljs-keyword">if</span> (event.<span class="hljs-property">target</span>.<span class="hljs-property">className</span> === <span class="hljs-string">&#x27;dropzone&#x27;</span>) {
    <span class="hljs-comment">// 恢复目标节点背景色</span>
    event.<span class="hljs-property">target</span>.<span class="hljs-property">style</span>.<span class="hljs-property">background</span> = <span class="hljs-string">&#x27;&#x27;</span>;
    <span class="hljs-comment">// 将被拖拉节点插入目标节点</span>
    dragged.<span class="hljs-property">parentNode</span>.<span class="hljs-title function_">removeChild</span>(dragged);
    event.<span class="hljs-property">target</span>.<span class="hljs-title function_">appendChild</span>( dragged );
  }
}, <span class="hljs-literal">false</span>);
</code></pre><p>关于拖拉事件，有以下几个注意点。</p><ul><li>拖拉过程只触发以上这些拖拉事件，尽管鼠标在移动，但是鼠标事件不会触发。</li><li>将文件从操作系统拖拉进浏览器，不会触发<code>dragstart</code>和<code>dragend</code>事件。</li><li><code>dragenter</code>和<code>dragover</code>事件的监听函数，用来取出拖拉的数据（即允许放下被拖拉的元素）。由于网页的大部分区域不适合作为放下拖拉元素的目标节点，所以这两个事件的默认设置为当前节点不允许接受被拖拉的元素。如果想要在目标节点上放下的数据，首先必须阻止这两个事件的默认行为。</li></ul><pre class="hljs"><code><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ondragover</span>=<span class="hljs-string">&quot;return false&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ondragover</span>=<span class="hljs-string">&quot;event.preventDefault()&quot;</span>&gt;</span>
</code></pre><p>上面代码中，如果不取消拖拉事件或者阻止默认行为，就不能在<code>div</code>节点上放下被拖拉的节点。</p><h2 id="dragevent-接口">DragEvent 接口 <a class="markdownIt-Anchor" href="#dragevent-接口">#</a></h2><p>拖拉事件都继承了<code>DragEvent</code>接口，这个接口又继承了<code>MouseEvent</code>接口和<code>Event</code>接口。</p><p>浏览器原生提供一个<code>DragEvent()</code>构造函数，用来生成拖拉事件的实例对象。</p><pre class="hljs"><code><span class="hljs-keyword">new</span> <span class="hljs-title class_">DragEvent</span>(type, options)
</code></pre><p><code>DragEvent()</code>构造函数接受两个参数，第一个参数是字符串，表示事件的类型，该参数必须；第二个参数是事件的配置对象，用来设置事件的属性，该参数可选。配置对象除了接受<code>MouseEvent</code>接口和<code>Event</code>接口的配置属性，还可以设置<code>dataTransfer</code>属性要么是<code>null</code>，要么是一个<code>DataTransfer</code>接口的实例。</p><p><code>DataTransfer</code>的实例对象用来读写拖拉事件中传输的数据，详见下文《DataTransfer 接口》的部分。</p><h2 id="datatransfer-接口概述">DataTransfer 接口概述 <a class="markdownIt-Anchor" href="#datatransfer-接口概述">#</a></h2><p>所有拖拉事件的实例都有一个<code>DragEvent.dataTransfer</code>属性，用来读写需要传递的数据。这个属性的值是一个<code>DataTransfer</code>接口的实例。</p><p>浏览器原生提供一个<code>DataTransfer()</code>构造函数，用来生成<code>DataTransfer</code>实例对象。</p><pre class="hljs"><code><span class="hljs-keyword">var</span> dataTrans = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataTransfer</span>();
</code></pre><p><code>DataTransfer()</code>构造函数不接受参数。</p><p>拖拉的数据分成两方面：数据的种类（又称格式）和数据的值。数据的种类是一个 MIME 字符串（比如<code>text/plain</code>、<code>image/jpeg</code>），数据的值是一个字符串。一般来说，如果拖拉一段文本，则数据默认就是那段文本；如果拖拉一个链接，则数据默认就是链接的 URL。</p><p>拖拉事件开始时，开发者可以提供数据类型和数据值。拖拉过程中，开发者通过<code>dragenter</code>和<code>dragover</code>事件的监听函数，检查数据类型，以确定是否允许放下（drop）被拖拉的对象。比如，在只允许放下链接的区域，检查拖拉的数据类型是否为<code>text/uri-list</code>。</p><p>发生<code>drop</code>事件时，监听函数取出拖拉的数据，对其进行处理。</p><h2 id="datatransfer-的实例属性">DataTransfer 的实例属性 <a class="markdownIt-Anchor" href="#datatransfer-的实例属性">#</a></h2><h3 id="datatransferdropeffect">DataTransfer.dropEffect <a class="markdownIt-Anchor" href="#datatransferdropeffect">#</a></h3><p><code>DataTransfer.dropEffect</code>属性用来设置放下（drop）被拖拉节点时的效果，会影响到拖拉经过相关区域时鼠标的形状。它可能取下面的值。</p><ul><li>copy：复制被拖拉的节点</li><li>move：移动被拖拉的节点</li><li>link：创建指向被拖拉的节点的链接</li><li>none：无法放下被拖拉的节点</li></ul><p>除了上面这些值，设置其他的值都是无效的。</p><pre class="hljs"><code>target.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;dragover&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) {
  e.<span class="hljs-title function_">preventDefault</span>();
  e.<span class="hljs-title function_">stopPropagation</span>();
  e.<span class="hljs-property">dataTransfer</span>.<span class="hljs-property">dropEffect</span> = <span class="hljs-string">&#x27;copy&#x27;</span>;
});
</code></pre><p>上面代码中，被拖拉元素一旦<code>drop</code>，接受的区域会复制该节点。</p><p><code>dropEffect</code>属性一般在<code>dragenter</code>和<code>dragover</code>事件的监听函数中设置，对于<code>dragstart</code>、<code>drag</code>、<code>dragleave</code>这三个事件，该属性不起作用。因为该属性只对接受被拖拉的节点的区域有效，对被拖拉的节点本身是无效的。进入目标区域后，拖拉行为会初始化成设定的效果。</p><h3 id="datatransfereffectallowed">DataTransfer.effectAllowed <a class="markdownIt-Anchor" href="#datatransfereffectallowed">#</a></h3><p><code>DataTransfer.effectAllowed</code>属性设置本次拖拉中允许的效果。它可能取下面的值。</p><ul><li>copy：复制被拖拉的节点</li><li>move：移动被拖拉的节点</li><li>link：创建指向被拖拉节点的链接</li><li>copyLink：允许<code>copy</code>或<code>link</code></li><li>copyMove：允许<code>copy</code>或<code>move</code></li><li>linkMove：允许<code>link</code>或<code>move</code></li><li>all：允许所有效果</li><li>none：无法放下被拖拉的节点</li><li>uninitialized：默认值，等同于<code>all</code></li></ul><p>如果某种效果是不允许的，用户就无法在目标节点中达成这种效果。</p><p>这个属性与<code>dropEffect</code>属性是同一件事的两个方面。前者设置被拖拉的节点允许的效果，后者设置接受拖拉的区域的效果，它们往往配合使用。</p><p><code>dragstart</code>事件的监听函数，可以用来设置这个属性。其他事件的监听函数里面设置这个属性是无效的。</p><pre class="hljs"><code>source.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;dragstart&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) {
  e.<span class="hljs-property">dataTransfer</span>.<span class="hljs-property">effectAllowed</span> = <span class="hljs-string">&#x27;move&#x27;</span>;
});

target.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;dragover&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) {
  e.<span class="hljs-property">dataTransfer</span>.<span class="hljs-property">dropEffect</span> = <span class="hljs-string">&#x27;move&#x27;</span>;
});
</code></pre><p>只要<code>dropEffect</code>属性和<code>effectAllowed</code>属性之中，有一个为<code>none</code>，就无法在目标节点上完成<code>drop</code>操作。</p><h3 id="datatransferfiles">DataTransfer.files <a class="markdownIt-Anchor" href="#datatransferfiles">#</a></h3><p><code>DataTransfer.files</code>属性是一个 FileList 对象，包含一组本地文件，可以用来在拖拉操作中传送。如果本次拖拉不涉及文件，则该属性为空的 FileList 对象。</p><p>下面就是一个接收拖拉文件的例子。</p><pre class="hljs"><code><span class="hljs-comment">// HTML 代码如下</span>
<span class="hljs-comment">// &lt;div id=&quot;output&quot; style=&quot;min-height: 200px;border: 1px solid black;&quot;&gt;</span>
<span class="hljs-comment">//   文件拖拉到这里</span>
<span class="hljs-comment">// &lt;/div&gt;</span>

<span class="hljs-keyword">var</span> div = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;output&#x27;</span>);

div.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;dragenter&quot;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"> event </span>) {
  div.<span class="hljs-property">textContent</span> = <span class="hljs-string">&#x27;&#x27;</span>;
  event.<span class="hljs-title function_">stopPropagation</span>();
  event.<span class="hljs-title function_">preventDefault</span>();
}, <span class="hljs-literal">false</span>);

div.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;dragover&quot;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"> event </span>) {
  event.<span class="hljs-title function_">stopPropagation</span>();
  event.<span class="hljs-title function_">preventDefault</span>();
}, <span class="hljs-literal">false</span>);

div.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&quot;drop&quot;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"> event </span>) {
  event.<span class="hljs-title function_">stopPropagation</span>();
  event.<span class="hljs-title function_">preventDefault</span>();
  <span class="hljs-keyword">var</span> files = event.<span class="hljs-property">dataTransfer</span>.<span class="hljs-property">files</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; files.<span class="hljs-property">length</span>; i++) {
    div.<span class="hljs-property">textContent</span> += files[i].<span class="hljs-property">name</span> + <span class="hljs-string">&#x27; &#x27;</span> + files[i].<span class="hljs-property">size</span> + <span class="hljs-string">&#x27;字节\n&#x27;</span>;
  }
}, <span class="hljs-literal">false</span>);
</code></pre><p>上面代码中，通过<code>dataTransfer.files</code>属性读取被拖拉的文件的信息。如果想要读取文件内容，就要使用<code>FileReader</code>对象。</p><pre class="hljs"><code>div.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;drop&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
  e.<span class="hljs-title function_">preventDefault</span>();
  e.<span class="hljs-title function_">stopPropagation</span>();

  <span class="hljs-keyword">var</span> fileList = e.<span class="hljs-property">dataTransfer</span>.<span class="hljs-property">files</span>;
  <span class="hljs-keyword">if</span> (fileList.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">var</span> file = fileList[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">var</span> reader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileReader</span>();
    reader.<span class="hljs-property">onloadend</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
      <span class="hljs-keyword">if</span> (e.<span class="hljs-property">target</span>.<span class="hljs-property">readyState</span> === <span class="hljs-title class_">FileReader</span>.<span class="hljs-property">DONE</span>) {
        <span class="hljs-keyword">var</span> content = reader.<span class="hljs-property">result</span>;
        div.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">&#x27;File: &#x27;</span> + file.<span class="hljs-property">name</span> + <span class="hljs-string">&#x27;\n\n&#x27;</span> + content;
      }
    }
    reader.<span class="hljs-title function_">readAsBinaryString</span>(file);
  }
});
</code></pre><h3 id="datatransfertypes">DataTransfer.types <a class="markdownIt-Anchor" href="#datatransfertypes">#</a></h3><p><code>DataTransfer.types</code>属性是一个只读的数组，每个成员是一个字符串，里面是拖拉的数据格式（通常是 MIME 值）。比如，如果拖拉的是文字，对应的成员就是<code>text/plain</code>。</p><p>下面是一个例子，通过检查<code>dataTransfer</code>属性的类型，决定是否允许在当前节点执行<code>drop</code>操作。</p><pre class="hljs"><code><span class="hljs-keyword">function</span> <span class="hljs-title function_">contains</span>(<span class="hljs-params">list, value</span>){
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; list.<span class="hljs-property">length</span>; ++i) {
    <span class="hljs-keyword">if</span>(list[i] === value) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }
  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">doDragOver</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-keyword">var</span> isLink = <span class="hljs-title function_">contains</span>(event.<span class="hljs-property">dataTransfer</span>.<span class="hljs-property">types</span>, <span class="hljs-string">&#x27;text/uri-list&#x27;</span>);
  <span class="hljs-keyword">if</span> (isLink) event.<span class="hljs-title function_">preventDefault</span>();
}
</code></pre><p>上面代码中，只有当被拖拉的节点有一个是链接时，才允许在当前节点放下。</p><h3 id="datatransferitems">DataTransfer.items <a class="markdownIt-Anchor" href="#datatransferitems">#</a></h3><p><code>DataTransfer.items</code>属性返回一个类似数组的只读对象（DataTransferItemList 实例），每个成员就是本次拖拉的一个对象（DataTransferItem 实例）。如果本次拖拉不包含对象，则返回一个空对象。</p><p>DataTransferItemList 实例具有以下的属性和方法。</p><ul><li><code>length</code>：返回成员的数量</li><li><code>add(data, type)</code>：增加一个指定内容和类型（比如<code>text/html</code>和<code>text/plain</code>）的字符串作为成员</li><li><code>add(file)</code>：<code>add</code>方法的另一种用法，增加一个文件作为成员</li><li><code>remove(index)</code>：移除指定位置的成员</li><li><code>clear()</code>：移除所有的成员</li></ul><p>DataTransferItem 实例具有以下的属性和方法。</p><ul><li><code>kind</code>：返回成员的种类（<code>string</code>还是<code>file</code>）。</li><li><code>type</code>：返回成员的类型（通常是 MIME 值）。</li><li><code>getAsFile()</code>：如果被拖拉是文件，返回该文件，否则返回<code>null</code>。</li><li><code>getAsString(callback)</code>：如果被拖拉的是字符串，将该字符传入指定的回调函数处理。该方法是异步的，所以需要传入回调函数。</li></ul><p>下面是一个例子。</p><pre class="hljs"><code>div.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;drop&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) {
  e.<span class="hljs-title function_">preventDefault</span>();
  <span class="hljs-keyword">if</span> (e.<span class="hljs-property">dataTransfer</span>.<span class="hljs-property">items</span> != <span class="hljs-literal">null</span>) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; e.<span class="hljs-property">dataTransfer</span>.<span class="hljs-property">items</span>.<span class="hljs-property">length</span>; i++) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e.<span class="hljs-property">dataTransfer</span>.<span class="hljs-property">items</span>[i].<span class="hljs-property">kind</span> + <span class="hljs-string">&#x27;: &#x27;</span> + e.<span class="hljs-property">dataTransfer</span>.<span class="hljs-property">items</span>[i].<span class="hljs-property">type</span>);
    }
  }
});
</code></pre><h2 id="datatransfer-的实例方法">DataTransfer 的实例方法 <a class="markdownIt-Anchor" href="#datatransfer-的实例方法">#</a></h2><h3 id="datatransfersetdata">DataTransfer.setData() <a class="markdownIt-Anchor" href="#datatransfersetdata">#</a></h3><p><code>DataTransfer.setData()</code>方法用来设置拖拉事件所带有的数据。该方法没有返回值。</p><pre class="hljs"><code>event.<span class="hljs-property">dataTransfer</span>.<span class="hljs-title function_">setData</span>(<span class="hljs-string">&#x27;text/plain&#x27;</span>, <span class="hljs-string">&#x27;Text to drag&#x27;</span>);
</code></pre><p>上面代码为当前的拖拉事件加入纯文本数据。</p><p>该方法接受两个参数，都是字符串。第一个参数表示数据类型（比如<code>text/plain</code>），第二个参数是具体数据。如果指定类型的数据在<code>dataTransfer</code>属性不存在，那么这些数据将被加入，否则原有的数据将被新数据替换。</p><p>如果是拖拉文本框或者拖拉选中的文本，会默认将对应的文本数据，添加到<code>dataTransfer</code>属性，不用手动指定。</p><pre class="hljs"><code><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">draggable</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;</span>
  aaa
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre><p>上面代码中，拖拉这个<code>&lt;div&gt;</code>元素会自动带上文本数据<code>aaa</code>。</p><p>使用<code>setData</code>方法，可以替换到原有数据。</p><pre class="hljs"><code><span class="hljs-tag">&lt;<span class="hljs-name">div</span>
  <span class="hljs-attr">draggable</span>=<span class="hljs-string">&quot;true&quot;</span>
  <span class="hljs-attr">ondragstart</span>=<span class="hljs-string">&quot;event.dataTransfer.setData(&#x27;text/plain&#x27;, &#x27;bbb&#x27;)&quot;</span>
&gt;</span>
  aaa
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre><p>上面代码中，拖拉数据实际上是<code>bbb</code>，而不是<code>aaa</code>。</p><p>下面是添加其他类型的数据。由于<code>text/plain</code>是最普遍支持的格式，为了保证兼容性，建议最后总是保存一份纯文本格式的数据。</p><pre class="hljs"><code><span class="hljs-keyword">var</span> dt = event.<span class="hljs-property">dataTransfer</span>;

<span class="hljs-comment">// 添加链接</span>
dt.<span class="hljs-title function_">setData</span>(<span class="hljs-string">&#x27;text/uri-list&#x27;</span>, <span class="hljs-string">&#x27;http://www.example.com&#x27;</span>);
dt.<span class="hljs-title function_">setData</span>(<span class="hljs-string">&#x27;text/plain&#x27;</span>, <span class="hljs-string">&#x27;http://www.example.com&#x27;</span>);

<span class="hljs-comment">// 添加 HTML 代码</span>
dt.<span class="hljs-title function_">setData</span>(<span class="hljs-string">&#x27;text/html&#x27;</span>, <span class="hljs-string">&#x27;Hello there, &lt;strong&gt;stranger&lt;/strong&gt;&#x27;</span>);
dt.<span class="hljs-title function_">setData</span>(<span class="hljs-string">&#x27;text/plain&#x27;</span>, <span class="hljs-string">&#x27;Hello there, &lt;strong&gt;stranger&lt;/strong&gt;&#x27;</span>);

<span class="hljs-comment">// 添加图像的 URL</span>
dt.<span class="hljs-title function_">setData</span>(<span class="hljs-string">&#x27;text/uri-list&#x27;</span>, imageurl);
dt.<span class="hljs-title function_">setData</span>(<span class="hljs-string">&#x27;text/plain&#x27;</span>, imageurl);
</code></pre><p>可以一次提供多种格式的数据。</p><pre class="hljs"><code><span class="hljs-keyword">var</span> dt = event.<span class="hljs-property">dataTransfer</span>;
dt.<span class="hljs-title function_">setData</span>(<span class="hljs-string">&#x27;application/x-bookmark&#x27;</span>, bookmarkString);
dt.<span class="hljs-title function_">setData</span>(<span class="hljs-string">&#x27;text/uri-list&#x27;</span>, <span class="hljs-string">&#x27;http://www.example.com&#x27;</span>);
dt.<span class="hljs-title function_">setData</span>(<span class="hljs-string">&#x27;text/plain&#x27;</span>, <span class="hljs-string">&#x27;http://www.example.com&#x27;</span>);
</code></pre><p>上面代码中，通过在同一个事件上面，存放三种类型的数据，使得拖拉事件可以在不同的对象上面，<code>drop</code>不同的值。注意，第一种格式是一个自定义格式，浏览器默认无法读取，这意味着，只有某个部署了特定代码的节点，才可能<code>drop</code>（读取到）这个数据。</p><h3 id="datatransfergetdata">DataTransfer.getData() <a class="markdownIt-Anchor" href="#datatransfergetdata">#</a></h3><p><code>DataTransfer.getData()</code>方法接受一个字符串（表示数据类型）作为参数，返回事件所带的指定类型的数据（通常是用<code>setData</code>方法添加的数据）。如果指定类型的数据不存在，则返回空字符串。通常只有<code>drop</code>事件触发后，才能取出数据。</p><p>下面是一个<code>drop</code>事件的监听函数，用来取出指定类型的数据。</p><pre class="hljs"><code><span class="hljs-keyword">function</span> <span class="hljs-title function_">onDrop</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-keyword">var</span> data = event.<span class="hljs-property">dataTransfer</span>.<span class="hljs-title function_">getData</span>(<span class="hljs-string">&#x27;text/plain&#x27;</span>);
  event.<span class="hljs-property">target</span>.<span class="hljs-property">textContent</span> = data;
  event.<span class="hljs-title function_">preventDefault</span>();
}
</code></pre><p>上面代码取出拖拉事件的文本数据，将其替换成当前节点的文本内容。注意，这时还必须取消浏览器的默认行为，因为假如用户拖拉的是一个链接，浏览器默认会在当前窗口打开这个链接。</p><p><code>getData</code>方法返回的是一个字符串，如果其中包含多项数据，就必须手动解析。</p><pre class="hljs"><code><span class="hljs-keyword">function</span> <span class="hljs-title function_">doDrop</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-keyword">var</span> lines = event.<span class="hljs-property">dataTransfer</span>.<span class="hljs-title function_">getData</span>(<span class="hljs-string">&#x27;text/uri-list&#x27;</span>).<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;\n&#x27;</span>);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> line <span class="hljs-keyword">of</span> lines) {
    <span class="hljs-keyword">let</span> link = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;a&#x27;</span>);
    link.<span class="hljs-property">href</span> = line;
    link.<span class="hljs-property">textContent</span> = line;
    event.<span class="hljs-property">target</span>.<span class="hljs-title function_">appendChild</span>(link);
  }
  event.<span class="hljs-title function_">preventDefault</span>();
}
</code></pre><p>上面代码中，<code>getData</code>方法返回的是一组链接，就必须自行解析。</p><p>类型值指定为<code>URL</code>，可以取出第一个有效链接。</p><pre class="hljs"><code><span class="hljs-keyword">var</span> link = event.<span class="hljs-property">dataTransfer</span>.<span class="hljs-title function_">getData</span>(<span class="hljs-string">&#x27;URL&#x27;</span>);
</code></pre><p>下面的例子是从多种类型的数据里面取出数据。</p><pre class="hljs"><code><span class="hljs-keyword">function</span> <span class="hljs-title function_">doDrop</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-keyword">var</span> types = event.<span class="hljs-property">dataTransfer</span>.<span class="hljs-property">types</span>;
  <span class="hljs-keyword">var</span> supportedTypes = [<span class="hljs-string">&#x27;text/uri-list&#x27;</span>, <span class="hljs-string">&#x27;text/plain&#x27;</span>];
  types = supportedTypes.<span class="hljs-title function_">filter</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) { types.<span class="hljs-title function_">includes</span>(value) });
  <span class="hljs-keyword">if</span> (types.<span class="hljs-property">length</span>) {
    <span class="hljs-keyword">var</span> data = event.<span class="hljs-property">dataTransfer</span>.<span class="hljs-title function_">getData</span>(types[<span class="hljs-number">0</span>]);
  }
  event.<span class="hljs-title function_">preventDefault</span>();
}
</code></pre><h3 id="datatransfercleardata">DataTransfer.clearData() <a class="markdownIt-Anchor" href="#datatransfercleardata">#</a></h3><p><code>DataTransfer.clearData()</code>方法接受一个字符串（表示数据类型）作为参数，删除事件所带的指定类型的数据。如果没有指定类型，则删除所有数据。如果指定类型不存在，则调用该方法不会产生任何效果。</p><pre class="hljs"><code>event.<span class="hljs-property">dataTransfer</span>.<span class="hljs-title function_">clearData</span>(<span class="hljs-string">&#x27;text/uri-list&#x27;</span>);
</code></pre><p>上面代码清除事件所带的<code>text/uri-list</code>类型的数据。</p><p>该方法不会移除拖拉的文件，因此调用该方法后，<code>DataTransfer.types</code>属性可能依然会返回<code>Files</code>类型（前提是存在文件拖拉）。</p><p>注意，该方法只能在<code>dragstart</code>事件的监听函数之中使用，因为这是拖拉操作的数据唯一可写的时机。</p><h3 id="datatransfersetdragimage">DataTransfer.setDragImage() <a class="markdownIt-Anchor" href="#datatransfersetdragimage">#</a></h3><p>拖动过程中（<code>dragstart</code>事件触发后），浏览器会显示一张图片跟随鼠标一起移动，表示被拖动的节点。这张图片是自动创造的，通常显示为被拖动节点的外观，不需要自己动手设置。</p><p><code>DataTransfer.setDragImage()</code>方法可以自定义这张图片。它接受三个参数。第一个是<code>&lt;img&gt;</code>节点或者<code>&lt;canvas&gt;</code>节点，如果省略或为<code>null</code>，则使用被拖动的节点的外观；第二个和第三个参数为鼠标相对于该图片左上角的横坐标和纵坐标。</p><p>下面是一个例子。</p><pre class="hljs"><code><span class="hljs-comment">/* HTML 代码如下
 &lt;div id=&quot;drag-with-image&quot; class=&quot;dragdemo&quot; draggable=&quot;true&quot;&gt;
   drag me
 &lt;/div&gt;
*/</span>

<span class="hljs-keyword">var</span> div = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;drag-with-image&#x27;</span>);
div.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;dragstart&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) {
  <span class="hljs-keyword">var</span> img = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;img&#x27;</span>);
  img.<span class="hljs-property">src</span> = <span class="hljs-string">&#x27;http://path/to/img&#x27;</span>;
  e.<span class="hljs-property">dataTransfer</span>.<span class="hljs-title function_">setDragImage</span>(img, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
}, <span class="hljs-literal">false</span>);
</code></pre></article><nav class="level level-previous-next is-mobile"><!-- Left side --><div class="level-left"><p class="level-item is-narrow"><a href="../javascript/touch.html"><span class="icon"><i class="fa fa-toggle-left"></i></span> 触摸事件</a></p></div><div class="level-right"><p class="level-item is-narrow"><a href="../javascript/common.html">其他常见事件 <span class="icon"><i class="fa fa-toggle-right"></i></span></a></p></div></nav><div class="page-info"><p>分享本文 <span class="social-share"></span></p></div></div><div class="column" style="flex:none;width:14%"><nav class="panel-info" style="border: 1px solid #ededed;"><p class="panel-heading" style="font-size: 1.0em;border-radius:0px;padding: 0.5em 0em;text-align: center;"><i class="fa fa-list-ul" aria-hidden="true"></i> Web前端教程</p><div class="panel-block" style="padding: 5px 0px;"><aside class="menu"><ul class="menu-list"><li><a href="/html/intro.html" target="_blank">&nbsp;HTML 教程</a></li><li><a href="/javascript/intro.html" target="_blank">&nbsp;JavaScript 教程</a></li><li><a href="/es6/intro.html" target="_blank">&nbsp;ES6 教程</a></li><li><a href="/typescript/intro.html" target="_blank">&nbsp;TypeScript 教程</a></li><!-- 
      <li><a href="/css/intro.html" target="_blank">&nbsp;CSS 教程</a></li>
   
      <li><a href="/webapi/intro.html" target="_blank">&nbsp;Web API 教程</a></li>
    --></ul></aside></div></nav></div></div></div></section><footer class="footer"><div class="container" style="max-width:1260px;"><div class="content has-text-centered"><p>V站（ViJian.com），上V站学全栈、全职兼职都能干<br><span>京ICP备13026726号-3</span></p></div></div></footer><script>var LOPPO={current_path:"javascript/drag.md",relative_root_path:"../",article_toc:'<ul class="markdownIt-TOC">\n<li><a href="#%E6%8B%96%E6%8B%89%E4%BA%8B%E4%BB%B6%E7%9A%84%E7%A7%8D%E7%B1%BB">拖拉事件的种类</a></li>\n<li><a href="#dragevent-%E6%8E%A5%E5%8F%A3">DragEvent 接口</a></li>\n<li><a href="#datatransfer-%E6%8E%A5%E5%8F%A3%E6%A6%82%E8%BF%B0">DataTransfer 接口概述</a></li>\n<li><a href="#datatransfer-%E7%9A%84%E5%AE%9E%E4%BE%8B%E5%B1%9E%E6%80%A7">DataTransfer 的实例属性</a>\n<ul>\n<li><a href="#datatransferdropeffect">DataTransfer.dropEffect</a></li>\n<li><a href="#datatransfereffectallowed">DataTransfer.effectAllowed</a></li>\n<li><a href="#datatransferfiles">DataTransfer.files</a></li>\n<li><a href="#datatransfertypes">DataTransfer.types</a></li>\n<li><a href="#datatransferitems">DataTransfer.items</a></li>\n</ul>\n</li>\n<li><a href="#datatransfer-%E7%9A%84%E5%AE%9E%E4%BE%8B%E6%96%B9%E6%B3%95">DataTransfer 的实例方法</a>\n<ul>\n<li><a href="#datatransfersetdata">DataTransfer.setData()</a></li>\n<li><a href="#datatransfergetdata">DataTransfer.getData()</a></li>\n<li><a href="#datatransfercleardata">DataTransfer.clearData()</a></li>\n<li><a href="#datatransfersetdragimage">DataTransfer.setDragImage()</a></li>\n</ul>\n</li>\n</ul>\n'}</script><script src="../assets/js/app.js"></script><!--script src="../assets/js/social-share.min.js"--><!--/script--><script>var shareDesc="我正在阅读《JavaScript 拖拉事件》，出自V站（ViJian.com）。",shareOpts={url:window.location.href,source:shareDesc,title:shareDesc,description:"",image:"",sites:["weibo","wechat","qq","qzone","twitter","facebook"],origin:"ViJian_com",disabled:[],wechatQrcodeTitle:"微信",wechatQrcodeHelper:"扫一下二维码，分享到微信。"};socialShare(".social-share",shareOpts)</script><script></script></body></html>